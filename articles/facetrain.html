<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="webmorphR.dlib">
<title>facetrain • webmorphR.dlib</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Roboto%20Flex-0.4.1/font.css" rel="stylesheet">
<link href="../deps/_Roboto-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="facetrain">
<meta property="og:description" content="webmorphR.dlib">
<meta property="og:image" content="https://debruine.github.io/webmorphR.dlib/reference/figures/card.png">
<meta property="og:image:alt" content="Blue hexagon with a simplified white wireframe face">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@lisadebruine">
<meta name="twitter:site" content="@webmorph_org">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">webmorphR.dlib</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/facetrain.html">facetrain</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/webmorph_org" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/debruine/webmorphR.dlib" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="facetrain_files/kePrint-0.0.1/kePrint.js"></script><link href="facetrain_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>facetrain</h1>
            
      
      
      <div class="d-none name"><code>facetrain.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://debruine.github.io/webmorphR" class="external-link">webmorphR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">webmorphR.dlib</span><span class="op">)</span>
<span class="fu"><a href="https://facelab.github.io/webmorph/reference/wm_opts.html" class="external-link">wm_opts</a></span><span class="op">(</span>plot.maxwidth <span class="op">=</span> <span class="fl">850</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/collectivemedia/tictoc" class="external-link">tictoc</a></span><span class="op">)</span> <span class="co"># for timing things</span></code></pre></div>
<div class="section level2">
<h2 id="basic-setup">Basic setup<a class="anchor" aria-label="anchor" href="#basic-setup"></a>
</h2>
<div class="section level3">
<h3 id="load-images">Load images<a class="anchor" aria-label="anchor" href="#load-images"></a>
</h3>
<p>First, load your faces and templates. The London demo set are really
big images (1350x1350 pixels) so I’m going to resize them to make some
of the later functions run faster.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demo_stim.html">demo_stim</a></span><span class="op">(</span><span class="st">"london"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/resize.html" class="external-link">resize</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="select-template-points">Select template points<a class="anchor" aria-label="anchor" href="#select-template-points"></a>
</h3>
<p>Next, select the template points you want to make a model for. Here,
we’re going to train a very simple model of just the centres of the
eyes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stim_2pt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://facelab.github.io/webmorph/reference/subset_tem.html" class="external-link">subset_tem</a></span><span class="op">(</span><span class="va">stim</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># plot to check</span>
<span class="va">stim_2pt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> |&gt; 
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/pt-check-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="xml-file">XML file<a class="anchor" aria-label="anchor" href="#xml-file"></a>
</h3>
<p>Use <code><a href="../reference/tem_to_xml.html">tem_to_xml()</a></code> to save the images to a directory,
write the template points to an xml file, and run a python script that
finds the “bounding box” of each face. This function returns the
location of the xml file, which you’ll need for the next step.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tem_to_xml.html">tem_to_xml</a></span><span class="op">(</span><span class="va">stim_2pt</span>, dir <span class="op">=</span> <span class="st">"images"</span><span class="op">)</span></code></pre></div>
<p>You can visualise the bounding boxes to check if anything went
wrong.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span><span class="va">xml</span>, crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/unnamed-chunk-5-1.png" width="100%"></p>
<p>If you have a lot of images, you can subset them by index to just
look at a sample. Set crop to FALSE and draw the template to view the
bounding box in the full image context.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span><span class="va">xml</span>, crop <span class="op">=</span> <span class="cn">FALSE</span>, subset <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>line.color <span class="op">=</span> <span class="st">"green"</span>, 
           line.size <span class="op">=</span> <span class="fl">10</span>, 
           line.alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/unnamed-chunk-6-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="facetrain">Facetrain<a class="anchor" aria-label="anchor" href="#facetrain"></a>
</h3>
<p>Now run <code><a href="../reference/facetrain.html">facetrain()</a></code> using the XML file. This will create
a shape predictor output file that you can use in auto-delineation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">"eyes.dat"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test">Test<a class="anchor" aria-label="anchor" href="#test"></a>
</h3>
<p>Test your shape predictor file on a few images</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eyes</span> <span class="op">&lt;-</span> <span class="st">"eyes.dat"</span>

<span class="va">stim_eyes</span> <span class="op">&lt;-</span> <span class="va">stim</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.7</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
             model_path <span class="op">=</span> <span class="st">"eyes.dat"</span><span class="op">)</span>

<span class="co"># plot to check</span>
<span class="va">stim_eyes</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> |&gt; 
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/test-first-dat-1.png" width="100%"></p>
<p>Not perfect, but we didn’t have very many images and only used the
default settings. It probably will be worse on out-of-set images:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smiling</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demo_stim.html">demo_stim</a></span><span class="op">(</span><span class="st">"smiling"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/resize.html" class="external-link">resize</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>

<span class="va">smiling_eyes</span> <span class="op">&lt;-</span> <span class="va">smiling</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
             model_path <span class="op">=</span> <span class="va">eyes</span><span class="op">)</span>

<span class="co"># plot to check</span>
<span class="va">smiling_eyes</span> |&gt; 
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/out-of-set-1.png" width="100%"></p>
<p>What if we change the size of the image, keeping the faces in the
center? Apply different croppings to the first image.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smiling</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.5</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,
       height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.7</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
             model_path <span class="op">=</span> <span class="va">eyes</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/position-1.png" width="100%"></p>
<p>That’s pretty bad. What if we change the face location in the
image?</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smiling</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, 
       x_off <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.2</span>, <span class="fl">.05</span><span class="op">)</span>,
       y_off <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.2</span>, <span class="fl">.05</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
             model_path <span class="op">=</span> <span class="va">eyes</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/location-1.png" width="100%"></p>
<p>Can it handle rotation?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smiling</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.6</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/rotate.html" class="external-link">rotate</a></span><span class="op">(</span>degrees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">45</span>, <span class="fl">45</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
             model_path <span class="op">=</span> <span class="va">eyes</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/rotate-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="train-on-more-images">Train on more images<a class="anchor" aria-label="anchor" href="#train-on-more-images"></a>
</h2>
<p>Clearly, there’s something lacking in our training. Maybe we don’t
have enough images, or they’re not diverse enough (the London set was
laboriously manually standardised).</p>
<p>Make more images by permuting the original images. At each step, add
the previous stimulus lists together to make a larger permuted set.
Start with rotation, since that takes the longest.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rotations</span> <span class="op">&lt;-</span> <span class="va">stim_2pt</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/rotate.html" class="external-link">rotate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">1</span><span class="op">)</span>, patch <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">crops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_2pt</span>, <span class="va">rotations</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">.05</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">.05</span><span class="op">)</span><span class="op">)</span>

<span class="va">sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_2pt</span>, <span class="va">rotations</span>, <span class="va">crops</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/resize.html" class="external-link">resize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.9</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span>

<span class="va">offsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.05</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stim_2pt</span>, <span class="va">rotations</span>, <span class="va">crops</span>, <span class="va">sizes</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, 
       x_off <span class="op">=</span> <span class="va">offsets</span><span class="op">$</span><span class="va">x</span>,
       y_off <span class="op">=</span> <span class="va">offsets</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></code></pre></div>
<p>Combine all of the image sets and give each a unique name.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_stim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
  <span class="va">stim_2pt</span>, 
  <span class="va">rotations</span>, 
  <span class="va">crops</span>,
  <span class="va">sizes</span>, 
  <span class="va">locations</span>
<span class="op">)</span> |&gt;
  <span class="fu"><a href="https://facelab.github.io/webmorph/reference/setnames.html" class="external-link">setnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"face_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">1632</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Check a random subsample to make sure the template points changed
size, location and rotation with the images.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">90210</span><span class="op">)</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">all_stim</span><span class="op">)</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">samp</span> <span class="op">&lt;-</span> <span class="va">all_stim</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>

<span class="co"># plot to check</span>
<span class="va">samp</span> |&gt;
  <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/unnamed-chunk-11-1.png" width="100%"></p>
<div class="section level3">
<h3 id="xml-file-1">XML file<a class="anchor" aria-label="anchor" href="#xml-file-1"></a>
</h3>
<p>This will take quite a while now. It takes my computer about 1 minute
to detect 100 face locations for the XML file. Luckily, this only needs
to be done once (make sure you comment this code out after you’ve run it
so you don’t accidentally run it again). Time for coffee!</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_xml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tem_to_xml.html">tem_to_xml</a></span><span class="op">(</span><span class="va">all_stim</span>, dir <span class="op">=</span> <span class="st">"allimages"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="default-parameters">Default parameters<a class="anchor" aria-label="anchor" href="#default-parameters"></a>
</h3>
<p>Train a model with default parameters. We’ll use tictoc to see how
long each training takes.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="st">"eyes-default.dat"</span><span class="op">)</span>
<span class="va">train_timing</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test-again">Test Again<a class="anchor" aria-label="anchor" href="#test-again"></a>
</h3>
<p>Test your shape predictor file on that same random subset of images.
We’ll be testing a fair, bit, so write a function to make it easier.
We’ll add some very out-of-set examples to see how well our models
generalise.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">oos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demo_stim.html">demo_stim</a></span><span class="op">(</span><span class="st">"zoom"</span><span class="op">)</span>

<span class="va">viz_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_path</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">in_set</span> <span class="op">&lt;-</span> <span class="va">samp</span> |&gt;
    <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
               model_path <span class="op">=</span> <span class="va">model_path</span><span class="op">)</span> |&gt; 
    <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  
  <span class="va">sm_set</span> <span class="op">&lt;-</span> <span class="va">smiling</span> |&gt;
    <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
               model_path <span class="op">=</span> <span class="va">model_path</span><span class="op">)</span> |&gt;
    <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">out_set</span> <span class="op">&lt;-</span> <span class="va">oos</span> |&gt;
    <span class="fu"><a href="https://facelab.github.io/webmorph/reference/auto_delin.html" class="external-link">auto_delin</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>,
               model_path <span class="op">=</span> <span class="va">model_path</span><span class="op">)</span> |&gt;
    <span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span>pt.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> |&gt; 
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">in_set</span>, <span class="va">sm_set</span>, <span class="va">out_set</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="st">"eyes-default.dat"</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-default-1.png" width="100%"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timing</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 22.018 sec elapsed</span></code></pre></div>
<p>Not terrible, but not perfect. Let’s try changing some of the
defaults.</p>
</div>
</div>
<div class="section level2">
<h2 id="changing-defaults">Changing Defaults<a class="anchor" aria-label="anchor" href="#changing-defaults"></a>
</h2>
<p>See <code><a href="../reference/facetrain.html">?facetrain</a></code> for explanations of all the arguments, or
the original source by Adrian Rosebrock at PyImageSearch: <a href="https://www.pyimagesearch.com/2019/12/16/training-a-custom-dlib-shape-predictor/" class="external-link">Training
a custom dlib shape predictor</a>.</p>
<table class="table">
<colgroup>
<col width="15%">
<col width="34%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="left">arg</th>
<th align="right">default</th>
<th align="left">explanation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">tree_depth</td>
<td align="right">5</td>
<td align="left">the depth of each regression tree; typically 2:8</td>
</tr>
<tr class="even">
<td align="left">nu</td>
<td align="right">0.5</td>
<td align="left">regularization parameter; must be 0:1</td>
</tr>
<tr class="odd">
<td align="left">cascade_depth</td>
<td align="right">15</td>
<td align="left">the number of cascades used to train the shape
predictor; typically 6:18</td>
</tr>
<tr class="even">
<td align="left">feature_pool_size</td>
<td align="right">400</td>
<td align="left">number of pixels used to generate features for the
random trees at each cascade</td>
</tr>
<tr class="odd">
<td align="left">num_test_splits</td>
<td align="right">50</td>
<td align="left">selects best features at each cascade when
training</td>
</tr>
<tr class="even">
<td align="left">oversampling_amount</td>
<td align="right">5</td>
<td align="left">controls the number of random deformations per image
(i.e., data augmentation) when training the shape predictor; typically
0:50</td>
</tr>
<tr class="odd">
<td align="left">jitter</td>
<td align="right">0.1</td>
<td align="left">amount of oversampling translation jitter to apply;
typically 0 to 0.5</td>
</tr>
<tr class="even">
<td align="left">num_threads</td>
<td align="right">0 (all available cores)</td>
<td align="left">number of threads/CPU cores to be used when
training</td>
</tr>
</tbody>
</table>
<p>Set up list of models timings to store the model construction and
prediction timings in.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  default <span class="op">=</span> <span class="st">"eyes-default.dat"</span>,
  td <span class="op">=</span> <span class="st">"eyes-td_7.dat"</span>,
  nu <span class="op">=</span> <span class="st">"eyes-nu_.1.dat"</span>,
  cd <span class="op">=</span> <span class="st">"eyes-cd_18.dat"</span>,
  fps <span class="op">=</span> <span class="st">"eyes-fps_600.dat"</span>,
  nts <span class="op">=</span> <span class="st">"eyes-nts_75.dat"</span>,
  oa <span class="op">=</span> <span class="st">"eyes-oa_10.dat"</span>,
  jitter <span class="op">=</span> <span class="st">"eyes-jitter_.2.dat"</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_timings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  default <span class="op">=</span> <span class="va">train_timing</span> 
<span class="op">)</span>

<span class="va">pred_timings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  default <span class="op">=</span> <span class="va">pred_timing</span> 
<span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="tree-depth">Tree Depth<a class="anchor" aria-label="anchor" href="#tree-depth"></a>
</h3>
<p>Let’s try increasing <code>tree_depth</code> from 5 to 7. Larger
values will make the model more accurate, but slower when making
predictions.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="va">models</span><span class="op">$</span><span class="va">td</span>,
          tree_depth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">train_timings</span><span class="op">$</span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">td</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-td-1.png" width="100%"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timings</span><span class="op">$</span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 28.036 sec elapsed</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="nu">Nu<a class="anchor" aria-label="anchor" href="#nu"></a>
</h3>
<p>Decrease nu from 0.5 to to 0.1. Decreasing this number helps models
to generalise, but requires a lot of training images.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="va">models</span><span class="op">$</span><span class="va">nu</span>,
          nu <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">train_timings</span><span class="op">$</span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">nu</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-nu-1.png" width="100%"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timings</span><span class="op">$</span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 21.594 sec elapsed</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cascade-depth">Cascade Depth<a class="anchor" aria-label="anchor" href="#cascade-depth"></a>
</h3>
<p>Increase <code>cascade_depth</code> from 15 to 18. This will make the
model more accurate, but the file size will be larger.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="va">models</span><span class="op">$</span><span class="va">cd</span>,
          cascade_depth <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>
<span class="va">train_timings</span><span class="op">$</span><span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">cd</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-cd-1.png" width="100%"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timings</span><span class="op">$</span><span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 22.491 sec elapsed</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="feature-pool-size">Feature Pool Size<a class="anchor" aria-label="anchor" href="#feature-pool-size"></a>
</h3>
<p>Increase <code>feature_pool_size</code> from 400 to 600. This will
make the model more accurate, but slower at making predictions.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="va">models</span><span class="op">$</span><span class="va">fps</span>,
          feature_pool_size <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
<span class="va">train_timings</span><span class="op">$</span><span class="va">fps</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">fps</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-fps-1.png" width="100%"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timings</span><span class="op">$</span><span class="va">fps</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 22.013 sec elapsed</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="number-of-test-splits">Number of Test Splits<a class="anchor" aria-label="anchor" href="#number-of-test-splits"></a>
</h3>
<p>Increase <code>test_splits</code> from 50 to 75. This will make the
model more accurate, but training will take longer.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="va">models</span><span class="op">$</span><span class="va">nts</span>,
          num_test_splits <span class="op">=</span> <span class="fl">75</span><span class="op">)</span>
<span class="va">train_timings</span><span class="op">$</span><span class="va">nts</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">nts</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-nts-1.png" width="100%"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timings</span><span class="op">$</span><span class="va">nts</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 21.201 sec elapsed</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="oversampling-amount">Oversampling Amount<a class="anchor" aria-label="anchor" href="#oversampling-amount"></a>
</h3>
<p>Increase the number of random deformations from 5 to 10. This can
increase generalisation, but will also increase training time.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="va">models</span><span class="op">$</span><span class="va">oa</span>,
          oversampling_amount <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">train_timings</span><span class="op">$</span><span class="va">oa</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">oa</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-oa-1.png" width="100%"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timings</span><span class="op">$</span><span class="va">oa</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 23.247 sec elapsed</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="jitter">Jitter<a class="anchor" aria-label="anchor" href="#jitter"></a>
</h3>
<p>Double <code>jitter</code> from 0.1 to 0.2. This increases the amount
of deformation applied when oversampling.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/facetrain.html">facetrain</a></span><span class="op">(</span><span class="va">all_xml</span>, <span class="va">models</span><span class="op">$</span><span class="va">jitter</span>,
          jitter <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">train_timings</span><span class="op">$</span><span class="va">jitter</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">viz_model</span><span class="op">(</span><span class="va">models</span><span class="op">$</span><span class="va">jitter</span><span class="op">)</span></code></pre></div>
<p><img src="images/facetrain/viz-test-jitter-1.png" width="100%"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_timings</span><span class="op">$</span><span class="va">jitter</span> <span class="op">&lt;-</span> <span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 21.639 sec elapsed</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-size-and-speed">Model size and speed<a class="anchor" aria-label="anchor" href="#model-size-and-speed"></a>
</h2>
<p>Model size is in MB. Speed in minutes.</p>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
size
</th>
<th style="text-align:right;">
train
</th>
<th style="text-align:right;">
pred
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
eyes-default.dat
</td>
<td style="text-align:right;">
8.3
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:left;">
eyes-td_7.dat
</td>
<td style="text-align:right;">
31.5
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
eyes-nu_.1.dat
</td>
<td style="text-align:right;">
8.5
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
eyes-cd_18.dat
</td>
<td style="text-align:right;">
9.9
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
eyes-fps_600.dat
</td>
<td style="text-align:right;">
8.4
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
eyes-nts_75.dat
</td>
<td style="text-align:right;">
8.2
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
eyes-oa_10.dat
</td>
<td style="text-align:right;">
8.4
</td>
<td style="text-align:right;">
3.5
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
eyes-jitter_.2.dat
</td>
<td style="text-align:right;">
8.3
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:right;">
0.4
</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lisa DeBruine.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
